<div id="resourceDialog" class="dialog">
  <div class="content-scroll" *ngIf="resourceForm">
    <div class="content-header" fxLayout="row">
      <h2 class="title-content" mat-dialog-title>
        {{
        "projects.project_register.project_resource_dialog.resource_registration"
        | translate }}
      </h2>
      <button mat-icon-button class="mat-icon-form" (click)="close()">
        <mat-icon>cancel</mat-icon>
      </button>
    </div>
    <div class="dialog-content">
      <mat-dialog-content class="mat-typography">
        <form class="form-content" [formGroup]="resourceForm" fxLayout="column">
          <div fxFlex="100" fxLayoutGap="16px">
            <mat-form-field *ngIf="this.method !== 'edit'" fxFlex="30" class="example-full-width" appearance="outline">
              <mat-label>{{ "projects.project_generic.collaborator" | translate
                }}</mat-label>
              <input type="text" placeholder="Colaborador" aria-label="text" #filter [errorStateMatcher]="matcher"
                matInput [matAutocomplete]="auto" [formControl]="collaboratorControl" />
              <mat-error *ngIf="
                collaboratorControl && collaboratorControl.hasError('required')
                ">
                {{ "validators.validator-required" | translate }}
              </mat-error>
              <mat-error *ngIf="
                collaboratorControl &&
                  !collaboratorControl.hasError('required') &&
                  collaboratorControl.hasError('incorrect')
                ">
                {{ "validators.select-option" | translate }}
              </mat-error>
              <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete" [displayWith]="displayFn">
                <mat-option *ngFor="let collaborator of filteredCollaborators" [value]="collaborator">
                  {{collaborator.firstNameCorporateName }}
                  {{collaborator.lastNameFantasyName}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <mat-form-field appearance="outline" *ngIf="this.method === 'edit'" fxFlex="30" class="example-full-width">
              <mat-label>{{ "projects.project_generic.collaborator" | translate
                }}</mat-label>
              <input disabled matInput disableRipple [value]="this.collaboratorControl.value" />
            </mat-form-field>

            <mat-form-field fxFlex="30" appearance="outline">
              <mat-label>{{ "projects.project_generic.paper" | translate }}</mat-label>
              <mat-select [errorStateMatcher]="matcher" class="select" disableRipple formControlName="paper">

                <mat-option *ngFor="let paper of papers" [value]="paper.id">{{paper.value}}</mat-option>

              </mat-select>
            </mat-form-field>

            <mat-form-field fxFlex="20" appearance="outline">
              <mat-label>
                {{ "projects.project_generic.estimated_hours" | translate
                }}</mat-label>
              <input matInput disableRipple [errorStateMatcher]="matcher" type="number" formControlName="estimatedHours"
                placeholder="Estimativa de Horas" />
            </mat-form-field>
            <div fxFlex="20" fxLayout="row">
              <button class="button-form" mat-button (click)="clear()" color="primary">
                <mat-icon>close</mat-icon>
              </button>
              <button *ngIf="this.method !== 'edit'" class="button-form" color="primary"
                [disabled]="resourceForm.invalid || collaboratorControl.invalid" mat-flat-button
                (click)="saveResource()">
                <mat-icon>save</mat-icon>
              </button>
              <button *ngIf="this.method === 'edit'" class="button-form" color="primary"
                [disabled]="resourceForm.invalid" mat-flat-button (click)="saveResource()">
                <mat-icon>save</mat-icon>
              </button>
            </div>
          </div>

          <mat-checkbox *ngIf="method === 'edit'" fxFlex="30" fxLayoutAlign="start start" class="checkbox disabled"
            color="primary" formControlName="isActive">Recurso {{resourceForm.controls['isActive'].value == true ?
            'Ativo': 'Inativo'}}</mat-checkbox>
        </form>

        <div class="envolti-table mat-elevation-z4">
          <table mat-table [dataSource]="dataTable" #resourceDialogTable>
            <ng-container matColumnDef="collaboratorId">
              <th mat-header-cell *matHeaderCellDef>
                {{ "projects.project_generic.collaborator" | translate }}
              </th>
              <td mat-cell *matCellDef="let resource">
                {{ resource.collaborator.firstNameCorporateName }}
                {{resource.collaborator.lastNameFantasyName}}
              </td>
            </ng-container>

            <ng-container matColumnDef="paper">
              <th mat-header-cell *matHeaderCellDef>Papel</th>
              <td mat-cell *matCellDef="let resource">
                {{resource.paper}}
              </td>
            </ng-container>

            <ng-container matColumnDef="estimatedHours">
              <th mat-header-cell *matHeaderCellDef>
                {{ "projects.project_generic.estimated_hours" | translate }}
              </th>
              <td mat-cell *matCellDef="let resource">
                {{ resource.estimatedHours }}
              </td>
            </ng-container>
            <ng-container matColumnDef="isActive">
              <th mat-header-cell *matHeaderCellDef>
                {{ "projects.project_generic.status" | translate }}
              </th>

              <td mat-cell *matCellDef="let resource">
                {{ resource.isActive ? 'Ativo' : 'Inativo' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="icon">
              <th mat-header-cell *matHeaderCellDef></th>
              <td fxLayoutAlign="end center" class="button-tab" mat-cell *matCellDef="let resource; let index = index">
                <button (click)="getResource(resource, resource.id, resource.collaborator.firstNameCorporateName )"
                  class="table-button" mat-button>
                  <mat-icon>edit</mat-icon>
                </button>

                <button (click)="deleteResource(resource.id)" class="table-button" mat-button>
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </div>
      </mat-dialog-content>
    </div>
  </div>
</div>